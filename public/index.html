<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AstroEra ‚Äì AI Powered Vedic Astrology | by Vedang Soni</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="google-site-verification" content="vMQeKXKG1Tik-KT3r47NCOf6LVaDQ8K9FpktamJr3T0" />
<!-- Google tag (gtag.js) --><!--Analytics-->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYKZW2JHVR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EYKZW2JHVR');
</script>

<!-- SEO -->
<meta name="description" content="AstroEra ‚Äì AI-powered Vedic Astrology insights. Generate your Kundli-based personality report instantly.">
<meta name="keywords" content="AstroEra, kundli, astrology, vedic, horoscope, AI kundli, birth chart, astro report">
<meta property="og:title" content="AstroEra ‚Äì AI Powered Vedic Astrology" />
<meta property="og:description" content="Generate AI-powered English & Hindi Kundli reports instantly." />
<meta property="og:type" content="website" />
<meta name="theme-color" content="#4f46e5" />

<style>
/* ROOT VARIABLES */
:root {
  --bg: #020617;
  --fg: #ffffff;
  --glass: rgba(255,255,255,0.08);
  --card: rgba(255,255,255,0.12);
  --border: rgba(255,255,255,0.16);
  --primary: #6366f1;
  --grad1: #4f46e5;
  --grad2: #ec4899;
  --radius: 20px;
  --blur: 18px;
}

body.light {
  --bg: #f1f5f9;
  --fg: #111827;
  --glass: rgba(255,255,255,0.7);
  --card: rgba(255,255,255,0.9);
  --border: rgba(0,0,0,0.18);
}

/* GLOBAL */
* {margin:0;padding:0;box-sizing:border-box;font-family:"Inter",sans-serif;}

body {
  background:var(--bg);
  color:var(--fg);
  min-height:100vh;
  padding:20px;
  display:flex;
  justify-content:center;
  overflow-x:hidden;
  transition:0.4s;
}

/* INTRO SCREEN */
#intro-screen {
  position:fixed; inset:0;
  display:flex; justify-content:center; align-items:center;
  background:radial-gradient(circle,#0f172a,#000);
  z-index:9999;
}
.intro-aura {
  position:absolute;
  width:320px; height:320px;
  background:radial-gradient(circle,rgba(120,120,255,0.4),transparent 70%);
  filter:blur(60px);
  animation:auraMove 8s infinite ease-in-out;
}
.aura2 { 
  width:360px; height:360px;
  background:radial-gradient(circle,rgba(255,80,180,0.45),transparent 70%);
  animation-duration:11s;
}
@keyframes auraMove {
  0% {transform:translate(-60px,-60px);}
  50% {transform:translate(110px,90px);}
  100% {transform:translate(-60px,-60px);}
}
.intro-center { text-align:center; z-index:10; }
.intro-om {
  font-size:90px;
  font-weight:900;
  color:#fbbf24;
  text-shadow:0 0 32px #fbbf24aa;
  cursor:pointer;
  animation:omPulse 2s infinite ease-in-out;
}
@keyframes omPulse {
  0% {transform:scale(1);}
  50% {transform:scale(1.2);}
  100% {transform:scale(1);}
}
.tap-text {
  margin-top:12px;
  font-size:17px;
  color:#ffffffaa;
  animation:tapBlink 2s infinite;
}
@keyframes tapBlink {
  0% {opacity:.4;}
  50% {opacity:1;}
  100% {opacity:.4;}
}
.intro-exit {
  animation:introFade .6s forwards;
}
@keyframes introFade {
  to {opacity:0; visibility:hidden;}
}

/* MAIN APP */
.app {
  width:100%;
  max-width:1200px;
  background:var(--glass);
  border-radius:var(--radius);
  border:1px solid var(--border);
  backdrop-filter:blur(14px);
  opacity:0; transform:translateY(40px);
  transition:0.6s;
}
.app.visible {opacity:1; transform:translateY(0);}

/* HEADER */
header {
  background:linear-gradient(to right,var(--grad1),var(--grad2));
  padding:18px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:white;
}
.brand {display:flex; gap:12px; align-items:center;}
.brand-icon {
  width:45px;height:45px;
  background:#fbbf24;
  color:black;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-size:22px;
  font-weight:900;
}
.theme-toggle {font-size:28px; cursor:pointer;}

/* LAYOUT */
main {
  display:flex; flex-wrap:wrap;
}
.left, .right {
  width:100%;
  padding:24px;
}
@media(min-width:850px){
  .left, .right { width:50%; }
  .left { border-right:1px solid var(--border); }
}

/* FORM */
form {display:flex; flex-direction:column; gap:15px;}

input, textarea, select {
  padding:12px;
  border-radius:var(--radius);
  border:1px solid var(--border);
  color:var(--fg);
  transition:0.25s;
}

/* Inputs slightly glass, selects solid */
input, textarea {
  background:rgba(255,255,255,0.14);
}
select {
  background:#0f172a;          /* solid for dark mode */
}
body.light select {
  background:#ffffff;          /* solid for light mode */
  color:#111827;
  border-color:rgba(0,0,0,0.2);
}

input:focus, textarea:focus, select:focus {
  border-color:var(--primary);
  transform:scale(1.02);
}

.btn-primary {
  padding:13px;
  border:none;
  border-radius:999px;
  cursor:pointer;
  background:linear-gradient(to right, var(--grad1), var(--grad2));
  color:white;
  font-weight:600;
}

/* CITY DROPDOWN */
#city-suggestions {
  position:absolute;
  top:100%; left:0; right:0;
  background:#0f172a;
  max-height:250px;
  overflow-y:auto;
  border-radius:var(--radius);
  border:1px solid var(--border);
  display:none;
  z-index:500;
}
.city-suggestion-item{
  padding:10px 12px;
  cursor:pointer;
  border-bottom:1px solid rgba(255,255,255,0.12);
}
.city-suggestion-item:hover{
  background:rgba(255,255,255,0.08);
}

/* RESULT CARD */
.result-card {
  min-height:260px;
  padding:18px;
  background:var(--card);
  border-radius:var(--radius);
  border:1px solid var(--border);
  white-space:pre-wrap;
}

/* VOICE BUTTONS */
.voice-controls {
  display:flex;
  gap:10px;
  margin:12px 0;
  flex-wrap:wrap;
}
.voice-btn {
  padding:8px 16px;
  border-radius:999px;
  background:linear-gradient(to right,var(--grad1),var(--grad2));
  border:1px solid var(--border);
  color:white;
  display:flex;
  align-items:center;
  gap:6px;
  cursor:pointer;
  font-size:14px;
}

/* SIMPLE SPINNER */
.loader {
  width:42px;
  height:42px;
  border-radius:50%;
  border:4px solid rgba(255,255,255,0.25);
  border-top-color:var(--primary);
  animation:spin .8s linear infinite;
  margin:20px auto;
}
@keyframes spin {to{transform:rotate(360deg);}}

/* FLOATING BAR */
.floating-bar {
  position:fixed;
  bottom:0; left:0; right:0;
  padding:10px;
  background:var(--glass);
  border-top:1px solid var(--border);
  display:flex; justify-content:space-around;
  backdrop-filter:blur(10px);
  z-index:900;
}
.action-btn {cursor:pointer; text-align:center;}
.action-btn span {font-size:22px; display:block;}

/* FOOTER */
footer {
  text-align:center;
  font-size:12px;
  opacity:.6;
  padding:20px 16px 90px;
  color:var(--fg);
  border-top:1px solid var(--border);
}

/* PRINT (kept for future, jsPDF now used) */
@media print {
  body {background:white !important; color:black !important; padding:0;}
  .floating-bar, header, footer, #intro-screen {display:none !important;}
  #mainApp {box-shadow:none !important; border:none !important; padding:0 !important;}
  #print-container {
    display:block !important;
    padding:40px;
    border:2px solid #00000033;
    border-radius:16px;
    font-size:16px;
    line-height:1.6;
  }
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro-screen">
  <div class="intro-aura"></div>
  <div class="intro-aura aura2"></div>

  <div class="intro-center">
    <div id="enterOm" class="intro-om">‡•ê</div>
    <div class="tap-text">Tap to Enter</div>
  </div>
</div>

<!-- MAIN APP -->
<div class="app" id="mainApp">

<header>
  <div class="brand">
    <div class="brand-icon">‡•ê</div>
    <h2>AstroEra</h2>
  </div>
  <div id="themeToggle" class="theme-toggle">üåô</div>
</header>

<main>
  <!-- LEFT SIDE -->
  <section class="left">
    <h2>Enter Birth Details</h2>

    <form id="astro-form">
      <div>
        <label>Name</label>
        <input id="name" required>
      </div>

      <div>
        <label>Gender</label>
        <select id="gender" required>
          <option value="">Select</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
      </div>

      <div>
        <label>Date of Birth</label>
        <input type="date" id="dob" required>
      </div>

      <div>
        <label>Time of Birth</label>
        <input type="time" id="tob" required>
      </div>

      <div style="position:relative;">
        <label>City</label>
        <input id="city" placeholder="Start typing..." autocomplete="off" required>
        <div id="city-suggestions"></div>
      </div>

      <div>
        <label>State</label>
        <input id="state" required>
      </div>

      <div>
        <label>Country</label>
        <input id="country" value="India" required>
      </div>

      <div>
        <label>Specific Concern</label>
        <textarea id="notes"></textarea>
      </div>

      <button class="btn-primary">üîÆ Generate Report</button>
    </form>
  </section>

  <!-- RIGHT SIDE -->
  <section class="right">
    <h2>Your Astro Report</h2>

    <div style="margin:10px 0;">
      <select id="report-lang">
        <option value="en">English</option>
        <option value="hi">Hindi</option>
      </select>
    </div>

    <div class="voice-controls">
      <button class="voice-btn" id="voicePlay"><span>‚ñ∂</span> Play</button>
      <button class="voice-btn" id="voicePause"><span>‚è∏</span> Pause</button>
      <button class="voice-btn" id="voiceStop"><span>‚èπ</span> Stop</button>
    </div>

    <div id="result-card" class="result-card">Your report will appear here‚Ä¶</div>

    <a id="whatsapp-button" class="btn-primary" target="_blank" style="margin-top:12px;display:inline-block;">
      üí¨ Talk to Astrologer
    </a>
  </section>
</main>

<footer>
  ¬© 2025 <strong>AstroEra</strong> by <strong>Vedang Soni</strong>. All Rights Reserved.
</footer>

</div>

<!-- FLOAT BAR -->
<div class="floating-bar">
  <div class="action-btn" id="copyReport"><span>üìÑ</span>Copy</div>
  <div class="action-btn" id="shareReport"><span>üì§</span>Share</div>
  <div class="action-btn" id="downloadPDF"><span>üì•</span>PDF</div>
</div>

<!-- Hidden print container (not used now but kept) -->
<div id="print-container" style="display:none;"></div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-/3pIWfQxQ7JxSUSSYIYwPxwlUPXmWgO0H1YtGCFfKijPltP7GXBpFQ8ef9OHn2xl6F+xyPVq0jzQp0hVFU7CwA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
/* ====== GLOBAL VOICE STATE ====== */
let synth = window.speechSynthesis;
let currentUtter = null;
let voicesLoaded = false;

function loadVoicesOnce() {
  if (!synth) return;
  const voices = synth.getVoices();
  if (voices && voices.length) {
    voicesLoaded = true;
  }
  synth.onvoiceschanged = () => {
    const v = synth.getVoices();
    if (v && v.length) {
      voicesLoaded = true;
    }
  };
}

/* INTRO TAP */
document.getElementById("enterOm").onclick = () => {
  const intro = document.getElementById("intro-screen");
  intro.classList.add("intro-exit");

  // Init voices inside user gesture (important for mobile)
  loadVoicesOnce();

  setTimeout(() => {
    intro.remove();
    document.getElementById("mainApp").classList.add("visible");
  }, 650);
};

/* THEME TOGGLE */
const themeToggle = document.getElementById("themeToggle");
let theme = localStorage.getItem("theme") || "dark";
applyTheme();

function applyTheme(){
  if(theme === "light"){
    document.body.classList.add("light");
    themeToggle.textContent = "‚òÄÔ∏è";
  } else {
    document.body.classList.remove("light");
    themeToggle.textContent = "üåô";
  }
}

themeToggle.onclick = () => {
  theme = theme === "dark" ? "light" : "dark";
  localStorage.setItem("theme", theme);
  applyTheme();
};

/* CITY SEARCH */
let citiesFlat = [];
(async () => {
  try {
    const res = await fetch("/cities.json");
    const data = await res.json();
    for (const [state, distObj] of Object.entries(data)) {
      for (const [dist, cityObj] of Object.entries(distObj)) {
        for (const city of Object.keys(cityObj)) {
          citiesFlat.push({ city, state });
        }
      }
    }
  } catch (e) {
    console.error("City load error:", e);
  }
})();

function fuzzyMatch(q,t){
  q=q.toLowerCase(); t=t.toLowerCase();
  if(t.startsWith(q)) return 3;
  if(t.includes(q)) return 2;
  if(q.split("").every(c=>t.includes(c))) return 1;
  return 0;
}

const cityInput = document.getElementById("city");
const stateInput = document.getElementById("state");
const citySug = document.getElementById("city-suggestions");

cityInput.addEventListener("input", () => {
  const q = cityInput.value.trim();
  if(q.length < 2 || !citiesFlat.length){
    citySug.style.display="none";
    return;
  }
  const results = citiesFlat
    .map(c=>({...c,score:fuzzyMatch(q,c.city)}))
    .filter(c=>c.score>0)
    .sort((a,b)=>b.score-a.score)
    .slice(0,25);
  citySug.innerHTML="";
  if(!results.length){citySug.style.display="none";return;}
  results.forEach(c=>{
    const div=document.createElement("div");
    div.className="city-suggestion-item";
    div.textContent=`${c.city}, ${c.state}`;
    div.onclick=()=>{
      cityInput.value=c.city;
      stateInput.value=c.state;
      citySug.style.display="none";
    };
    citySug.appendChild(div);
  });
  citySug.style.display="block";
});

document.addEventListener("mousedown",e=>{
  if(!citySug.contains(e.target) && e.target!==cityInput){
    citySug.style.display="none";
  }
});

/* ASTRO HELPERS */
function getZodiac(m,d){
  if((m===2&&d>=21)||(m===3&&d<=19))return"Aries";
  if((m===3&&d>=20)||(m===4&&d<=20))return"Taurus";
  if((m===4&&d>=21)||(m===5&&d<=20))return"Gemini";
  if((m===5&&d>=21)||(m===6&&d<=22))return"Cancer";
  if((m===6&&d>=23)||(m===7&&d<=22))return"Leo";
  if((m===7&&d>=23)||(m===8&&d<=22))return"Virgo";
  if((m===8&&d>=23)||(m===9&&d<=22))return"Libra";
  if((m===9&&d>=23)||(m===10&&d<=21))return"Scorpio";
  if((m===10&&d>=22)||(m===11&&d<=21))return"Sagittarius";
  if((m===11&&d>=22)||(m===0&&d<=19))return"Capricorn";
  if((m===0&&d>=20)||(m===1&&d<=18))return"Aquarius";
  return"Pisces";
}

function getLifePath(date){
  let num=[...(date.getFullYear()+""+(date.getMonth()+1)+date.getDate())]
    .reduce((a,b)=>a+ +b,0);
  while(num>9){
    num=[...(""+num)].reduce((x,y)=>x+ +y,0);
  }
  return num;
}

function splitDescription(text){
  const enTag="[ENGLISH]", hiTag="[‡§π‡§ø‡§®‡•ç‡§¶‡•Ä]";
  const enIndex=text.indexOf(enTag);
  const hiIndex=text.indexOf(hiTag);
  if(enIndex===-1 && hiIndex===-1) return{en:text.trim(),hi:""};
  if(hiIndex===-1) return{en:text.replace(enTag,"").trim(),hi:""};
  return{
    en:text.slice(enIndex+enTag.length,hiIndex).trim(),
    hi:text.slice(hiIndex+hiTag.length).trim()
  };
}

function cleanText(txt){
  return txt
    .replace(/\*/g,"")
    .replace(/_/g,"")
    .replace(/\s{2,}/g," ");
}

/* REPORT GENERATION */
let descriptionFull="", descriptionEN="", descriptionHI="";
const resultCard=document.getElementById("result-card");

document.getElementById("astro-form").onsubmit=async(e)=>{
  e.preventDefault();
  resultCard.innerHTML=`<div class="loader"></div>`;

  const name=document.getElementById("name").value;
  const gender=document.getElementById("gender").value;
  const dob=document.getElementById("dob").value;
  const tob=document.getElementById("tob").value;
  const city=cityInput.value;
  const state=stateInput.value;
  const country=document.getElementById("country").value;
  const notes=document.getElementById("notes").value;

  const d=new Date(dob);
  const zodiac=getZodiac(d.getMonth(),d.getDate());
  const lifePath=getLifePath(d);

  const payload={name,gender,dob,tob,city,state,country,notes,zodiac,lifePath};

  const res=await fetch("/api/astro",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  });

  const data=await res.json();
  let text=data.description||"";
  text=cleanText(text);
  descriptionFull=text;

  const parts=splitDescription(text);
  descriptionEN=cleanText(parts.en);
  descriptionHI=cleanText(parts.hi);

  document.getElementById("report-lang").value="en";
  resultCard.textContent=descriptionEN||descriptionFull;

  document.getElementById("whatsapp-button").href=
    "https://wa.me/917974517991?text="+encodeURIComponent(text);
};

/* LANGUAGE SWITCH */
document.getElementById("report-lang").onchange=()=>{
  const lang=document.getElementById("report-lang").value;
  if(lang==="en") resultCard.textContent=descriptionEN||descriptionFull;
  else resultCard.textContent=descriptionHI||descriptionFull;
};

/* ===== FIXED VOICE READER (MOBILE FRIENDLY) ===== */
function getVoiceFor(lang) {
  if (!synth) return null;
  const voices = synth.getVoices();
  if (!voices || !voices.length) return null;

  let v = voices.find(v => v.lang.toLowerCase() === lang.toLowerCase());
  if (v) return v;

  if (lang.startsWith("hi")) {
    v = voices.find(v => v.lang.toLowerCase().includes("hi"));
    if (v) return v;
  }
  return voices[0] || null;
}

function speakNow() {
  if (!synth) {
    alert("Your browser does not support voice.");
    return;
  }

  if (!voicesLoaded) {
    loadVoicesOnce();
  }

  const lang = document.getElementById("report-lang").value;
  let t = lang === "en"
    ? (descriptionEN || descriptionFull)
    : (descriptionHI || descriptionFull);

  if (!t) {
    alert("Generate report first.");
    return;
  }

  const testVoices = synth.getVoices();
  if (!testVoices || !testVoices.length) {
    alert("Voice not available on this device/browser right now. Try another browser or desktop.");
    return;
  }

  t = cleanText(t);

  if (currentUtter) synth.cancel();

  const utter = new SpeechSynthesisUtterance(t);
  utter.lang = (lang === "en") ? "en-IN" : "hi-IN";
  utter.rate = (lang === "hi") ? 0.9 : 1.0;
  utter.pitch = 1.0;

  const v = getVoiceFor(utter.lang);
  if (v) utter.voice = v;

  currentUtter = utter;
  synth.speak(utter);
}

document.getElementById("voicePlay").onclick = () => {
  if (!synth) {
    alert("Voice not supported in this browser.");
    return;
  }
  if (synth.paused && currentUtter) synth.resume();
  else speakNow();
};
document.getElementById("voicePause").onclick = () => {
  if (synth && synth.speaking) synth.pause();
};
document.getElementById("voiceStop").onclick = () => {
  if (synth) synth.cancel();
  currentUtter = null;
};

/* COPY / SHARE */
document.getElementById("copyReport").onclick=()=>{
  navigator.clipboard.writeText(descriptionFull||"");
  alert("Copied!");
};

document.getElementById("shareReport").onclick=()=>{
  if(navigator.share){
    navigator.share({title:"AstroEra Report",text:descriptionFull});
  }else{
    navigator.clipboard.writeText(descriptionFull||"");
    alert("Copied!");
  }
};

/* REAL PDF (jsPDF) */
document.getElementById("downloadPDF").onclick=()=>{
  const lang=document.getElementById("report-lang").value;
  const text=(lang==="en"?descriptionEN:descriptionHI)||"";
  if(!text){alert("Generate report first.");return;}
  if(!window.jspdf){alert("PDF library load error.");return;}

  const { jsPDF }=window.jspdf;
  const doc=new jsPDF({unit:"pt",format:"a4"});
  const pageWidth=doc.internal.pageSize.getWidth();
  const pageHeight=doc.internal.pageSize.getHeight();
  const marginX=40;
  let y=60;

  // Header
  doc.setFont("Helvetica","bold");
  doc.setFontSize(22);
  doc.text("ASTROERA REPORT", marginX, y);
  y+=22;
  doc.setFontSize(12);
  doc.setFont("Helvetica","normal");
  doc.text("AI Vedic Astrology Analysis", marginX, y);
  y+=8;
  doc.setDrawColor(0);
  doc.setLineWidth(0.7);
  doc.line(marginX, y, pageWidth-marginX, y);
  y+=24;

  // Body text with wrapping and page break
  doc.setFontSize(12);
  const maxWidth=pageWidth-marginX*2;
  const lines=doc.splitTextToSize(text, maxWidth);
  const lineHeight=16;

  lines.forEach(line=>{
    if(y > pageHeight-60){
      doc.addPage();
      y=60;
    }
    doc.text(line, marginX, y);
    y+=lineHeight;
  });

  // Footer last page
  const footerY=pageHeight-40;
  doc.setFontSize(9);
  doc.text("¬© 2025 AstroEra by Vedang Soni ‚Äî All Rights Reserved.", marginX, footerY);

  doc.save(`astroera_report_${lang}.pdf`);
};
</script>
</body>
</html>
