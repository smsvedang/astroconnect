<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AstroConnect</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===========================================================
   STYLE-C MOTION UI + GLASSMORPHISM THEME
   =========================================================== */

:root {
  --bg: #020617;
  --bg-glass: rgba(255,255,255,0.05);
  --fg: #ffffff;
  --card: rgba(255,255,255,0.08);
  --border: rgba(255,255,255,0.18);
  --primary: #6366f1;
  --grad1: #4f46e5;
  --grad2: #ec4899;
  --radius: 18px;
  --blur: 20px;
  --transition: 0.3s ease;
}

.light {
  --bg: #e2e8f0;
  --bg-glass: rgba(255,255,255,0.6);
  --fg: #111827;
  --card: rgba(255,255,255,0.7);
  --border: rgba(0,0,0,0.1);
  --primary: #4f46e5;
  --grad1: #6366f1;
  --grad2: #ec4899;
}

* {
  margin:0; padding:0; box-sizing:border-box;
  font-family: "Inter", system-ui, sans-serif;
  transition: background var(--transition), color var(--transition);
}

body {
  background: var(--bg);
  background-size:cover;
  color: var(--fg);
  padding: 18px;
  min-height: 100vh;
  display:flex;
  justify-content:center;
  animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
  from{ opacity:0; transform: translateY(20px); }
  to{ opacity:1; transform: translateY(0); }
}

.app {
  width:100%;
  max-width:1200px;
  background: var(--bg-glass);
  border-radius: var(--radius);
  border:1px solid var(--border);
  backdrop-filter: blur(var(--blur));
  overflow:hidden;
  box-shadow: 0 15px 45px rgba(0,0,0,0.35);
}

/* HEADER ------------------------------------------------------- */
header {
  background: linear-gradient(to right, var(--grad1), var(--grad2));
  padding:15px 22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:#fff;
  animation: slideDown 0.6s ease-out;
}
@keyframes slideDown {
  from{ transform: translateY(-20px); opacity:0; }
  to{ transform: translateY(0); opacity:1; }
}

.brand {
  display:flex; gap:12px; align-items:center;
}
.brand-icon {
  width:42px; height:42px;
  border-radius:50%;
  background:#fbbf24;
  color:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  font-size:20px;
  box-shadow:0 0 18px #fbbf24aa;
  transform:scale(0.8);
  animation: popIn 0.5s ease-out forwards;
}
@keyframes popIn {
  0%{ transform: scale(0.6); opacity:0; }
  100%{ transform: scale(1); opacity:1; }
}

.theme-toggle {
  cursor:pointer;
  font-size:26px;
  user-select:none;
  transition:0.2s;
}
.theme-toggle:hover {
  transform:rotate(15deg);
}

/* LAYOUT -------------------------------------------------------- */
main {
  display:flex;
  flex-wrap:wrap;
}
.left, .right {
  width:100%;
  padding:24px;
}
@media(min-width:850px){
  .left, .right { width:50%; }
  .left { border-right:1px solid var(--border); }
}

/* FORM ---------------------------------------------------------- */
form {
  display:flex;
  flex-direction:column;
  gap:16px;
  animation: fadeIn 0.8s ease-out;
}

label {
  font-size:14px;
  opacity:0.8;
}

input, textarea, select {
  padding:12px;
  border-radius: var(--radius);
  border:1px solid var(--border);
  background: rgba(255,255,255,0.06);
  color: var(--fg);
  outline:none;
  backdrop-filter: blur(10px);
  transition: 0.25s ease;
}

input:focus, textarea:focus, select:focus {
  border-color: var(--primary);
  transform: scale(1.02);
  background: rgba(255,255,255,0.12);
}

.btn-primary {
  padding:14px;
  background: linear-gradient(to right, var(--grad1), var(--grad2));
  border:none;
  border-radius:999px;
  color:#fff;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  box-shadow:0 6px 20px rgba(79,70,229,0.3);
  transition:0.3s;
}

.btn-primary:hover {
  transform: translateY(-2px) scale(1.03);
}

/* RESULT AREA ------------------------------------------------- */
.result-card {
  min-height:260px;
  background: var(--card);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:16px;
  white-space:pre-wrap;
  animation: fadeInUp 0.6s ease-out;
}
@keyframes fadeInUp {
  from{ opacity:0; transform: translateY(20px); }
  to{ opacity:1; transform: translateY(0); }
}

/* LOADER ------------------------------------------------------ */
.loader {
  width:45px; height:45px;
  border-radius:50%;
  border:4px solid #ffffff33;
  border-top-color: var(--primary);
  animation: spin 0.7s linear infinite;
  margin:20px auto;
}
@keyframes spin { to{ transform:rotate(360deg);} }

/* CITY DROPDOWN ---------------------------------------------- */
.city-field { position:relative; }

#city-suggestions {
  position:absolute;
  top:100%; left:0; right:0;
  background: var(--bg-glass);
  border:1px solid var(--border);
  border-radius: var(--radius);
  max-height:250px;
  overflow-y:auto;
  display:none;
  backdrop-filter: blur(12px);
  animation: fadeIn 0.2s ease-out;
}

.city-suggestion-item {
  padding:12px;
  cursor:pointer;
  border-bottom:1px solid var(--border);
  transition:0.2s;
}
.city-suggestion-item:hover {
  background: rgba(255,255,255,0.12);
  transform:scale(1.02);
}

/* FLOATING ACTION BAR ---------------------------------------- */
.floating-bar {
  position:fixed;
  bottom:0; left:0; right:0;
  background: var(--bg-glass);
  backdrop-filter: blur(15px);
  border-top:1px solid var(--border);
  padding:10px;
  display:flex;
  justify-content:space-around;
  z-index:100;
}

.action-btn {
  display:flex;
  flex-direction:column;
  align-items:center;
  font-size:12px;
  color:var(--fg);
  cursor:pointer;
  text-decoration:none;
}
.action-btn span { font-size:22px; }

</style>
</head>

<body>
<div class="app">

<!-- HEADER ---------------------------------------------------- -->
<header>
  <div class="brand">
    <div class="brand-icon">‡•ê</div>
    <div><h2>AstroConnect</h2></div>
  </div>

  <div id="themeToggle" class="theme-toggle">üåô</div>
</header>

<main>

<!-- LEFT PANEL ------------------------------------------------ -->
<section class="left">

  <h2 style="margin-bottom:10px;">Enter Your Birth Details</h2>

  <form id="astro-form">

    <div>
      <label>Full Name</label>
      <input id="name" required>
    </div>

    <div>
      <label>Gender</label>
      <select id="gender" required>
        <option value="">Select</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>
    </div>

    <div>
      <label>Date of Birth</label>
      <input type="date" id="dob" required>
    </div>

    <div>
      <label>Time of Birth</label>
      <input type="time" id="tob" required>
    </div>

    <div class="city-field">
      <label>City</label>
      <input id="city" autocomplete="off" required>
      <div id="city-suggestions"></div>
    </div>

    <div>
      <label>State</label>
      <input id="state" required>
    </div>

    <div>
      <label>Country</label>
      <input id="country" value="India" required>
    </div>

    <div>
      <label>Specific Concern</label>
      <textarea id="notes" rows="2"></textarea>
    </div>

    <button class="btn-primary">üîÆ Generate Report</button>

  </form>

</section>

<!-- RIGHT PANEL ------------------------------------------------ -->
<section class="right">
  <h2>Your Astro Report</h2>

  <select id="report-lang" style="margin:10px 0;">
    <option value="both">English + Hindi</option>
    <option value="en">English Only</option>
    <option value="hi">Hindi Only</option>
  </select>

  <div id="result-card" class="result-card">
    <p style="opacity:.6;">Your report will appear here‚Ä¶</p>
  </div>

  <a id="whatsapp-button" class="btn-primary" target="_blank" style="margin-top:15px;display:inline-block;">
    üí¨ Chat with Astrologer
  </a>
</section>

</main>
</div>

<!-- FLOATING BAR ---------------------------------------------- -->
<div class="floating-bar">
  <a class="action-btn" id="copyReport"><span>üìÑ</span>Copy</a>
  <a class="action-btn" id="shareReport"><span>üì§</span>Share</a>
  <a class="action-btn" id="downloadPDF"><span>üì•</span>PDF</a>
</div>

<!-- SCRIPT ===================================================== -->
<script>

/* ---------- THEME TOGGLE ---------- */
const themeToggle=document.getElementById("themeToggle");
let theme=localStorage.getItem("theme") || "dark";
applyTheme();
function applyTheme(){
  if(theme==="light"){document.body.classList.add("light"); themeToggle.textContent="‚òÄÔ∏è";}
  else{document.body.classList.remove("light"); themeToggle.textContent="üåô";}
}
themeToggle.onclick = () => {
  theme = theme==="dark"?"light":"dark";
  localStorage.setItem("theme",theme);
  applyTheme();
};

/* --------- LOAD CITIES ----------- */
let citiesFlat=[];
(async ()=>{
  const res=await fetch("/cities.json");
  const json=await res.json();
  for(const [state,dist] of Object.entries(json)){
    for(const [d,places] of Object.entries(dist)){
      for(const city of Object.keys(places)){
        citiesFlat.push({city,state});
      }
    }
  }
})();

/* ---------- FUZZY MATCH ---------- */
function fuzzyMatch(q,t){
  q=q.toLowerCase(); t=t.toLowerCase();
  if(t.startsWith(q)) return 3;
  if(t.includes(q)) return 2;
  if(q.split("").every(c=>t.includes(c))) return 1;
  return 0;
}

/* ---------- CITY AUTOCOMPLETE ---------- */
const cityInput=document.getElementById("city");
const stateInput=document.getElementById("state");
const citySuggestions=document.getElementById("city-suggestions");

cityInput.addEventListener("input",()=>{
  const q=cityInput.value.trim();
  if(q.length<2){citySuggestions.style.display="none"; return;}

  const matches=citiesFlat
    .map(c=>({...c,score:fuzzyMatch(q,c.city)}))
    .filter(c=>c.score>0)
    .sort((a,b)=>b.score-a.score)
    .slice(0,20);

  citySuggestions.innerHTML="";
  if(!matches.length){ citySuggestions.style.display="none"; return; }

  matches.forEach(c=>{
    const item=document.createElement("div");
    item.className="city-suggestion-item";
    item.innerHTML=`<strong>${c.city}</strong><small>${c.state}</small>`;
    item.addEventListener("mousedown",e=>{
      e.preventDefault();
      cityInput.value=c.city;
      stateInput.value=c.state;
      citySuggestions.style.display="none";
    });
    citySuggestions.appendChild(item);
  });

  citySuggestions.style.display="block";
});

document.addEventListener("mousedown",e=>{
  if(!citySuggestions.contains(e.target) && e.target!==cityInput){
    citySuggestions.style.display="none";
  }
});


/* ---------- ZODIAC ---------- */
function getZodiacSign(m,d){
  if((m===2&&d>=21)||(m===3&&d<=19))return"Aries";
  if((m===3&&d>=20)||(m===4&&d<=20))return"Taurus";
  if((m===4&&d>=21)||(m===5&&d<=20))return"Gemini";
  if((m===5&&d>=21)||(m===6&&d<=22))return"Cancer";
  if((m===6&&d>=23)||(m===7&&d<=22))return"Leo";
  if((m===7&&d>=23)||(m===8&&d<=22))return"Virgo";
  if((m===8&&d>=23)||(m===9&&d<=22))return"Libra";
  if((m===9&&d>=23)||(m===10&&d<=21))return"Scorpio";
  if((m===10&&d>=22)||(m===11&&d<=21))return"Sagittarius";
  if((m===11&&d>=22)||(m===0&&d<=19))return"Capricorn";
  if((m===0&&d>=20)||(m===1&&d<=18))return"Aquarius";
  return"Pisces";
}

/* ---------- LIFE PATH ---------- */
function getLifePath(d){
  let s=[...(d.getFullYear()+""+(d.getMonth()+1)+d.getDate())].reduce((x,y)=>x+ +y,0);
  while(s>9) s=[...(""+s)].reduce((a,b)=>a+ +b,0);
  return s;
}

/* ---------- SPLIT EN/HINDI ---------- */
function splitDescription(text){
  const enTag="[ENGLISH]";
  const hiTag="[‡§π‡§ø‡§®‡•ç‡§¶‡•Ä]";

  const enIndex=text.indexOf(enTag);
  const hiIndex=text.indexOf(hiTag);

  if(enIndex===-1 && hiIndex===-1) return {en:text, hi:""};

  if(hiIndex===-1){
    return {en:text.replace(enTag,"").trim(), hi:""};
  }

  const en=text.slice(enIndex+enTag.length, hiIndex).trim();
  const hi=text.slice(hiIndex+hiTag.length).trim();

  return {en, hi};
}

/* ---------- GENERATE REPORT ---------- */
let descriptionFull="", descriptionEN="", descriptionHI="";
const resultCard=document.getElementById("result-card");

document.getElementById("astro-form").addEventListener("submit", async e=>{
  e.preventDefault();

  resultCard.innerHTML = `
    <div class="loader"></div>
    <p style="text-align:center;opacity:.7;">Generating your report‚Ä¶</p>
  `;

  const name=document.getElementById("name").value;
  const gender=document.getElementById("gender").value;
  const dob=document.getElementById("dob").value;
  const tob=document.getElementById("tob").value;
  const notes=document.getElementById("notes").value;
  const city=cityInput.value;
  const state=stateInput.value;
  const country=document.getElementById("country").value;

  const d=new Date(dob);
  const zodiac=getZodiacSign(d.getMonth(),d.getDate());
  const lifePath=getLifePath(d);

  const payload={name,gender,dob,tob,city,state,country,notes,zodiac,lifePath};

  const res=await fetch("/api/astro",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  });

  const data=await res.json();
  const text=data.description;

  descriptionFull=text;
  const parts=splitDescription(text);
  descriptionEN=parts.en;
  descriptionHI=parts.hi;

  resultCard.textContent=text;
});

/* ---------- LANGUAGE SWITCH ---------- */
document.getElementById("report-lang").addEventListener("change",()=>{
  const lang=document.getElementById("report-lang").value;

  if(lang==="both") resultCard.textContent=descriptionFull;
  else if(lang==="en") resultCard.textContent=descriptionEN || "English section not available.";
  else if(lang==="hi") resultCard.textContent=descriptionHI || "‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
});

/* ---------- WHATSAPP ---------- */
document.getElementById("whatsapp-button").onclick = () => {
  const msg=encodeURIComponent(descriptionFull);
  window.open("https://wa.me/917974517991?text="+msg);
};

/* ---------- COPY / SHARE / PDF ---------- */
document.getElementById("copyReport").onclick=()=>{
  navigator.clipboard.writeText(descriptionFull);
  alert("Copied!");
};

document.getElementById("shareReport").onclick=()=>{
  if(navigator.share){
    navigator.share({title:"Astro Report", text:descriptionFull});
  } else {
    navigator.clipboard.writeText(descriptionFull);
    alert("Sharing not supported. Copied!");
  }
};

document.getElementById("downloadPDF").onclick=()=>{
  const w=window.open("","_blank");
  w.document.write(`<pre>${descriptionFull.replace(/</g,"&lt;")}</pre>`);
  w.print();
};

</script>

</body>
</html>
